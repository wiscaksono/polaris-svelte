<script lang="ts">
	import type { Snippet } from 'svelte';
	import type { ListMenu } from '$lib/type';

	import { convertMenu } from './converter';

	interface $$Props {
		children: Snippet;
		listMenu: ListMenu[];
	}

	let { children, listMenu }: $$Props = $props();

	let isOpen = $state(false);

	const menu = convertMenu(listMenu);

	function toggleSidebar(event: KeyboardEvent) {
		const isCmd = event.metaKey;
		const isCtrl = event.ctrlKey;
		const isB = event.key === 'b';

		if ((isCmd || isCtrl) && isB) {
			event.preventDefault();
			isOpen = !isOpen;
		}
	}
</script>

<svelte:window onkeydown={toggleSidebar} />

<div class="flex h-dvh">
	<aside class={`border-r bg-black p-4 ${isOpen ? 'w-64' : 'w-16'}`}>
		<header class="mb-5 flex h-7 items-center justify-center">
			{#if isOpen}
				<svg
					width="163"
					height="26"
					viewBox="0 0 163 26"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
					<path
						d="M6.31 25.08H0V0.546021H11.951C14.776 0.546021 17.111 1.39402 18.703 2.99702C20.248 4.55502 21.065 6.78502 21.065 9.44602C21.0732 10.577 20.8562 11.6983 20.4266 12.7446C19.9971 13.7908 19.3636 14.7411 18.563 15.54C16.785 17.31 14.29 18.244 11.356 18.244H6.309L6.31 25.08ZM10.728 1.79702L9.46 6.61702C9.38103 7.0099 9.18429 7.36941 8.89597 7.64772C8.60765 7.92604 8.24142 8.10996 7.846 8.17502L3.128 9.39502L7.843 10.615C8.23887 10.68 8.60552 10.8642 8.89406 11.1429C9.1826 11.4216 9.37933 11.7816 9.458 12.175L10.724 16.994L11.991 12.174C12.07 11.7811 12.2667 11.4216 12.555 11.1433C12.8433 10.865 13.2096 10.6811 13.605 10.616L18.325 9.39502L13.609 8.17502C13.2136 8.10996 12.8473 7.92604 12.559 7.64772C12.2707 7.36941 12.074 7.0099 11.995 6.61702L10.728 1.79702Z"
						fill="#E11F27"
					/>
					<path
						d="M37.9831 0C30.3071 0 24.3501 5.222 24.3501 12.688C24.3501 20.153 30.3081 25.375 37.9821 25.375C45.6561 25.375 51.6141 20.153 51.6141 12.687C51.6151 5.223 45.6601 0 37.9831 0ZM37.9831 19.73C33.6371 19.73 30.8331 16.857 30.8331 12.686C30.8331 8.515 33.6371 5.641 37.9831 5.641C42.3291 5.641 45.1681 8.515 45.1681 12.686C45.1681 16.856 42.3291 19.733 37.9831 19.733V19.731V19.73ZM73.4871 19.45H61.8161V0.42H55.5071V24.955H73.4871V19.45ZM96.1981 24.951H103.03L92.1331 0.421H86.0341L75.1341 24.955H81.9341L83.4061 21.307H94.7261L96.1981 24.951ZM85.5781 16.017L88.4881 8.867L89.0861 7.253L89.6831 8.867L92.5931 16.017H85.5781ZM121.679 24.955H129.144L123.151 16.823C126.236 15.281 127.848 12.302 127.848 8.867C127.848 3.995 124.553 0.42 118.665 0.42H105.557V24.955H111.866V17.875H116.773L121.679 24.955ZM111.866 5.923H117.403C120.172 5.923 121.399 6.87 121.399 9.008C121.399 10.83 120.453 12.408 117.333 12.408H111.866V5.923ZM138.433 0.423H132.124V24.955H138.432L138.433 0.423ZM149.403 7.363C149.403 6.311 150.455 5.365 152.698 5.365C155.025 5.461 157.307 6.046 159.394 7.082L161.672 2.175C159.1 0.742749 156.204 -0.00545382 153.26 0.002C146.986 0.002 143.026 3.122 143.096 7.959C143.271 16.756 156.519 14.197 156.519 17.948C156.519 19.49 154.311 19.911 152.629 19.911C149.79 19.911 146.846 18.684 144.603 17.422L142.151 22.399C145.324 24.3544 148.974 25.3973 152.701 25.413C158.831 25.41 163 22.464 163 17.383C163 8.166 149.403 11.215 149.403 7.36V7.363Z"
						fill="#ffffff"
					/>
				</svg>
			{:else}
				<svg
					width="22"
					height="25"
					viewBox="0 0 22 25"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
					<path
						d="M6.31 24.534H0V0H11.951C14.776 0 17.111 0.848 18.703 2.451C20.248 4.009 21.065 6.239 21.065 8.9C21.0732 10.031 20.8562 11.1523 20.4266 12.1985C19.9971 13.2448 19.3636 14.1951 18.563 14.994C16.785 16.764 14.29 17.698 11.356 17.698H6.309L6.31 24.534ZM10.728 1.251L9.46 6.071C9.38103 6.46388 9.18429 6.82339 8.89597 7.1017C8.60765 7.38002 8.24142 7.56394 7.846 7.629L3.128 8.849L7.843 10.069C8.23887 10.134 8.60552 10.3181 8.89406 10.5969C9.1826 10.8756 9.37933 11.2356 9.458 11.629L10.724 16.448L11.991 11.628C12.07 11.2351 12.2667 10.8756 12.555 10.5973C12.8433 10.319 13.2096 10.1351 13.605 10.07L18.325 8.849L13.609 7.629C13.2136 7.56394 12.8473 7.38002 12.559 7.1017C12.2707 6.82339 12.074 6.46388 11.995 6.071L10.728 1.251Z"
						fill="#E11F27"
					/>
				</svg>
			{/if}
		</header>

		<ul class="space-y-2">
			{#each menu as item (item.id)}
				<li>
					<a
						href={item.href}
						class={`rounded-lg border whitespace-nowrap text-white ${!isOpen ? 'grid size-8 place-items-center' : 'flex h-8 items-center gap-2 p-1'}`}
					>
						<item.icon class={`shrink-0 ${!isOpen ? 'mx-auto' : 'size-6'}`} />
						{#if isOpen}
							<span class="flex-1 text-sm">
								{item.name}
							</span>
						{/if}
					</a>
				</li>
			{/each}
		</ul>
	</aside>

	<main class="p-2">
		{@render children()}
	</main>
</div>
